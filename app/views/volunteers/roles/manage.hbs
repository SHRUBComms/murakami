<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.min.js"></script>

<div class="row mt-4 ml-1">
  <div class="col-lg-8 col-md-10 mx-auto">
    {{#ifGreaterThan user.working_groups.length 1}}
      <div class="row">
        <div class="form-group form-inline">
          <select class="form-control" id="working_groups">
							{{#ifUserClass user.class '["admin"]'}}
								<option value="all"{{#ifCond group_id '==' 'all'}} selected{{/ifCond}}>All Working Groups</option>
							{{/ifUserClass}}
             	<option value=""{{#unless group_id}} selected{{/unless}}>All My Working Groups</option>
              {{#each user.allWorkingGroupsObj}}
                <option value='{{group_id}}'{{#ifCond group_id '==' ../group_id}} selected{{/ifCond}}>{{name}}</option>
              {{/each}}
          </select>
        </div>
      </div>
    {{/ifGreaterThan}}
  </div>
</div>

<div class="row mt-1 mb-4">

	<div class="col-lg-8 col-md-10 mx-auto">
			<table class="fadeIn table-light" data-pagination="true" data-search="true" data-striped="true" data-toggle="table" style="border: none !important;">
				<thead>
					<th data-sortable="true">Role Title</th>
          <th data-sortable="true">Working Group</th>
          <th data-sortable="true">Status</th>
          <th data-sortable="true">On Website</th>
					<th></th>
				</thead>
				<tbody>
				{{#unless group_id}}

					{{#each rolesGroupedByGroupId}}
						{{#if (lookupArray ../user.working_groups @key)}}
							{{#each this}}
								<tr>
									<td>
										{{details.title}}
									</td>
									<td>
										{{#if group_id}}
											{{lookup (lookup ../../user.allWorkingGroupsObj group_id) 'name'}}
										{{else}}
											Not Applicable
										{{/if}}
									</td>

									<td>
										{{#if incomplete}}
											<span class="text-danger">Incomplete</span>
										{{else}}
											{{#if removed}}
												<span class="text-danger">Disabled</span>
											{{else}}
												<p class="text-success">Active</p>
											{{/if}}
										{{/if}}
									</td>

                  <td>
                    {{#if public}}
                      <p class="text-success">Published</p>
                    {{else}}
                      <p class="text-muted">Unpublished</p>
                    {{/if}}
                  </td>
									<td><a href="{{public_address}}/volunteers/roles/view/{{role_id}}" class="btn btn-block btn-primary">View/Update</a></td>
								</tr>
							{{/each}}
						{{/if}}
					{{/each}}

				{{else}}
					{{#ifCond group_id '==' 'all'}}
						{{#each roles}}
						<tr>
							<td>
								{{details.title}}
							</td>
							<td>
								{{#if group_id}}
									{{lookup (lookup ../user.allWorkingGroupsObj group_id) 'name'}}
								{{else}}
									Not Applicable
								{{/if}}
							</td>

							<td>
								{{#if incomplete}}
									<span class="text-danger">Incomplete</span>
								{{else}}
									{{#if removed}}
										<span class="text-danger">Disabled</span>
									{{else}}
										{{#if public}}
											<p class="text-success">Active (public)</p>
										{{else}}
											<p class="text-success">Active (private)</p>
										{{/if}}
									{{/if}}
								{{/if}}
							</td>
							<td><a href="{{public_address}}/volunteers/roles/view/{{role_id}}" class="btn btn-block btn-primary">View/Update</a></td>
						</tr>
						{{/each}}
					{{else}}
						{{#each rolesGroupedByGroupId}}
							{{#ifCond ../group_id '==' @key}}
								{{#each this}}
									<tr>
										<td>
											{{details.title}}
										</td>
										<td>
											{{#if group_id}}
												{{lookup (lookup ../../user.allWorkingGroupsObj group_id) 'name'}}
											{{else}}
												Not Applicable
											{{/if}}
										</td>

										<td>
											{{#if incomplete}}
												<span class="text-danger">Incomplete</span>
											{{else}}
												{{#if removed}}
													<span class="text-danger">Disabled</span>
												{{else}}
													{{#if public}}
														<p class="text-success">Active (public)</p>
													{{else}}
														<p class="text-success">Active (private)</p>
													{{/if}}
												{{/if}}
											{{/if}}
										</td>
										<td><a href="{{public_address}}/volunteers/roles/view/{{role_id}}" class="btn btn-block btn-primary">View/Update</a></td>
									</tr>
								{{/each}}
							{{/ifCond}}
						{{/each}}
					{{/ifCond}}
				{{/unless}}
				</tbody>
			</table>
	</div>

</div>

<script>
$('#working_groups').on('change', function () {
  var url = "{{public_address}}/volunteers/roles/manage?group_id=" + $(this).val();
  window.location = url;
});
</script>
