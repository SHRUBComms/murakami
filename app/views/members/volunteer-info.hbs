<form method="post" action="/members/volunteer-info/{{member.member_id}}" class="form-group">
  <div class="row">
  	<div class="col-md-12 mx-auto">

  		<div class="row mt-4 mb-2 mx-auto">
  			<div class="card">
          <div class="card-body">
            <h1>{{member.first_name}} {{member.last_name}}</h1>
            <a class='btn btn-primary mt-3 mb-3' href="{{public_address}}/members/view/{{member.member_id}}">View Membership Profile</a>

            {{#if volInfo}}
              <p>Last update: <b>{{volInfo.lastUpdated}}</b></p>
            {{/if}}

            <p>
              <a href="{{public_address}}/api/get/members/id-remind/{{member.member_id}}">Send Volunteer Their Membership ID</a>
            </p>
          </div>
        </div>
      </div>



        <div class="row mt-4 mb-4">
    			<div class="col-lg-6">
    				<div class="card">
    					<div class="card-body">


                <h3 class="mb-2">Roles <span class="text-danger">*</span></h3>



                <div class="form-group form-inline">
                  <div class="form-group">

                    <select class="form-control" id="roleWGInput">
                      <option disabled selected>Select a working group...</option>
                      {{#each allWorkingGroups}}
                        <option value='{{group_id}}'>{{name}}</option>
                      {{/each}}
                    </select>

                  </div>
                  <div class="form-group">
                    <input type="text" class="form-control" id="roleInput" placeholder="Role Name" />
                  </div>
                  <div class="form-group">
                    <a class="btn btn-primary" id="addRole" onclick="addRole()">Add Role</a>
                  </div>
                </div>

                <div id="rolesInfo" class="d-none">
                  <p>Selected roles:</p>
                </div>
                <div class="row mb-4 mt-2">
                  <div class="col-md-8">
                    <ul id="roleSummary" class="list-group"></ul>
                  </div>
                </div>
                <input type="hidden" name="volInfo[roles]" id="roles" value="{{{json volInfo.roles}}}" />


                <div class="form-group form-inline">

                  <p><input type="checkbox" name="rolesExplained" required /> The role(s) have been been explained <span class="text-danger">*</span></p>

                </div>
              </div>
            </div>


          </div>

    			<div class="col-lg-6">
            <div class="row">
              <div class="card">
                <div class="card-body">

                <h3 class="mb-2">Our Agreement</h3>

                <p><b>Committed Hours Per Week</b> (must not exceed 15 hrs/week) <span class="text-danger">*</span></p>
                <div class="form-group col-sm-4" style="padding: 0;">
                  <input type="number" min="1" max="15" step="1" class="form-control" placeholder="Hours Per Week" name="volInfo[hoursPerWeek]" id="hoursPerWeek" {{#if volInfo.hoursPerWeek}}value="{{volInfo.hoursPerWeek}}"{{/if}} required>
                </div>

                <div class="form-group form-inline">
                  <p><input type="checkbox" name="volunteerAgreement" required> Yes, I commit to the role(s), responsibilities and time commitment as detailed in each volunteer role description <span class="text-danger">*</span></p>
                </div>


                <div class="form-group form-inline">
                  <p><input type="checkbox" name="benefitsExplained" required /> Membership benefits explained <span class="text-danger">*</span></p>
                </div>
              </div>
            </div>
          </div>
          <div class="row mt-4">
            <div class="card">
              <div class="card-body">
                <h3 class="mb-2">Availability <span class="text-danger">*</span></h3>

                <div class="row">

                  <table id="availabilityTable" class="table">
                    <tr>
                      <td></td>
                      <td>Morning (9-12)</td>
                      <td>Afternoon (12-5)</td>
                      <td>Evening (5-8)</td>
                    </tr>
                    <tr>
                      <td>Monday</td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][mon_m]" {{#if volInfo.availability.mon_m}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][mon_a]" {{#if volInfo.availability.mon_a}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][mon_e]" {{#if volInfo.availability.mon_e}}checked{{/if}} />
                      </td>
                    </tr>
                    <tr>
                      <td>Tuesday</td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][tue_m]" {{#if volInfo.availability.tue_m}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][tue_a]" {{#if volInfo.availability.tue_a}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][tue_e]" {{#if volInfo.availability.tue_e}}checked{{/if}} />
                      </td>
                    </tr>
                    <tr>
                      <td>Wednesday</td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][wed_m]" {{#if volInfo.availability.wed_m}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][wed_a]" {{#if volInfo.availability.wed_a}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][wed_e]" {{#if volInfo.availability.wed_e}}checked{{/if}} />
                      </td>
                    </tr>
                    <tr>
                      <td>Thursday</td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][thu_m]" {{#if volInfo.availability.thu_m}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][thu_a]" {{#if volInfo.availability.thu_a}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][thu_e]" {{#if volInfo.availability.thu_e}}checked{{/if}} />
                      </td>
                    </tr>
                    <tr>
                      <td>Friday</td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][fri_m]" {{#if volInfo.availability.fri_m}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][fri_a]" {{#if volInfo.availability.fri_a}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][fri_e]" {{#if volInfo.availability.fri_e}}checked{{/if}} />
                      </td>
                    </tr>
                    <tr>
                      <td>Saturday</td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sat_m]" {{#if volInfo.availability.sat_m}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sat_ea]" {{#if volInfo.availability.sat_ea}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sat_a]" {{#if volInfo.availability.sat_a}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sat_la]" {{#if volInfo.availability.sat_la}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sat_e]" {{#if volInfo.availability.sat_e}}checked{{/if}} />
                      </td>
                    </tr>
                    <tr>
                      <td>Sunday</td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sun_m]" {{#if volInfo.availability.sun_m}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sun_ea]" {{#if volInfo.availability.sun_ea}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sun_a]" {{#if volInfo.availability.sun_a}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sun_la]" {{#if volInfo.availability.sun_la}}checked{{/if}} />
                      </td>
                      <td>
                        <input type="checkbox" name="volInfo[availability][sun_e]" {{#if volInfo.availability.sun_e}}checked{{/if}} />
                      </td>
                    </tr>
                  </table>

                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <hr />
  </div>

  <div class="row">
  	<div class="col-md-8 mx-auto">


    <div class="row mt-4">
      <div class="col-md-8 mx-auto">

        <button type="submit" class="btn btn-block btn-primary btn-lg form-control">
          {{#if volInfo}}
            Update Volunteer Info
          {{else}}
            Add Volunteer!
          {{/if}}
        </button>
      </div>
    </div>

</form>

<script>

{{#if volInfo.roles}}
  var roles = {{{json volInfo.roles}}}
{{else}}
  var roles = []
{{/if}}

function addRole(){
  var role = {};
  role.wg_id = $("#roleWGInput").val().trim();
  role.wg_name = $("#roleWGInput").children("option:selected").text().trim()
  role.name = $("#roleInput").val().trim();
  roles.push(role);
  updateSummary();
}

function removeRole(index){
  roles.splice(index, 1);
  updateSummary();
}

function updateSummary(){

  $("#roleInput").val("");

  $("#roles").val(JSON.stringify(roles));

  if(roles.length === 0){
    $("#rolesInfo").addClass("d-none")
  } else {
    $("#rolesInfo").removeClass("d-none")
  }

  $("#roleSummary").html("");
  for(let i=0;i<roles.length;i++) {
    $("#roleSummary").html($("#roleSummary").html() +
      "<li class='list-group-item'>" + roles[i].name + " (with " + roles[i].wg_name + ") - <a onclick='removeRole(\"" + i + "\")' class='clickable text-info'>remove</a></li>");
  }

}



updateSummary();
</script>
